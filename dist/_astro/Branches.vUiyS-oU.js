import{d as l,y as S}from"./hooks.module.BKHCj0z0.js";import{u as e}from"./jsxRuntime.module.fOORsCCE.js";import"./preact.module.B5PsXcXZ.js";function z(){const[d,B]=l(null),[P,h]=l(!0),[b,E]=l(null),[m,M]=l([]),[$,y]=l(new Set),[g,k]=l(new Set);S(()=>{fetch("/game-data.json").then(n=>{if(!n.ok)throw new Error(`Failed to load game data: ${n.statusText}`);return n.json()}).then(n=>{B(n.gameData),h(!1)}).catch(n=>{E(n.message),h(!1)})},[]);const F=(n,t)=>{if(!t.choices||t.choices.length===0)return!0;const a=n.match(/^section-(\d+)$/);if(a){const s=parseInt(a[1],10);if(s>=400&&s<=499||s>=500&&s<=519)return!0}return!1},L=(n,t)=>{const a=[],s=new Map(Object.entries(n)),i=50,o=100;let c=0;const p=(r,N,w,C,T=0)=>{if(c>=o)return;if(T>i){console.warn(`Path exceeded max depth at ${r}`);return}if(C.has(r))return;const f=s.get(r);if(!f){console.warn(`Section not found: ${r}`);return}const x=[...N,r],v=[...w],A=new Set(C);if(A.add(r),F(r,f)){c++,a.push({pathId:`path-${c}`,sections:x,choices:v});return}f.choices&&f.choices.length>0?f.choices.forEach(u=>{c>=o||u.target&&(s.has(u.target)?p(u.target,x,[...v,u.text],A,T+1):console.warn(`Invalid target section: ${u.target} from ${r}`))}):(c++,a.push({pathId:`path-${c}`,sections:x,choices:v}))};if(!s.has(t))return console.error(`Starting section not found: ${t}`),[];try{p(t,[],[],new Set,0),console.log(`Found ${a.length} complete paths from ${t}`)}catch(r){console.error("Error finding paths:",r)}return a};S(()=>{if(d){h(!0);const n=()=>{try{console.log("Starting path finding...");const t=performance.now(),a=L(d,"section-1"),s=performance.now();console.log(`Path finding completed in ${(s-t).toFixed(2)}ms`),M(a),h(!1),a.length>0?y(new Set([a[0].pathId])):console.warn("No paths found!")}catch(t){console.error("Error generating branches:",t),E(`Error generating branches: ${t.message}`),h(!1)}};window.requestIdleCallback?requestIdleCallback(n,{timeout:5e3}):setTimeout(n,0)}},[d]);const D=n=>{const t=new Set($);t.has(n)?t.delete(n):t.add(n),y(t)},H=n=>{const t=new Set(g);t.has(n)?t.delete(n):t.add(n),k(t)},_=(n,t)=>{t.stopPropagation();const a=n.sections.map(o=>`${n.pathId}-${o}`),s=a.every(o=>g.has(o)),i=new Set(g);s?a.forEach(o=>i.delete(o)):a.forEach(o=>i.add(o)),k(i)};return P?e("div",{className:"loading",children:e("p",{children:"Loading branches... This may take a moment."})}):b?e("div",{className:"error",children:[e("h1",{children:"Error"}),e("p",{children:b})]}):d?e("div",{className:"branches-container",children:[e("h1",{children:"Story Branches"}),e("p",{className:"branches-intro",children:"All complete story paths from section-1 to terminal endings. Use this view to review each branch for continuity errors."}),e("p",{className:"branches-count",children:["Found ",m.length," complete branch",m.length!==1?"es":"",m.length===0&&e("span",{style:{color:"orange",marginLeft:"10px"},children:"(No paths found - check console for details)"})]}),m.length===0?e("div",{className:"error",style:{marginTop:"20px"},children:[e("p",{children:"No branches found. This could mean:"}),e("ul",{children:[e("li",{children:"No terminal endings exist in the game data"}),e("li",{children:"All paths are circular (no valid endings)"}),e("li",{children:"Section-1 doesn't exist or has no valid choices"})]}),e("p",{children:"Check the browser console for detailed error messages."})]}):e("div",{className:"branches-list",children:m.map((n,t)=>{const a=$.has(n.pathId);return e("div",{className:"branch-item",children:[e("div",{className:"branch-header",onClick:()=>D(n.pathId),children:[e("span",{className:"branch-toggle",children:a?"▼":"▶"}),e("span",{className:"branch-title",children:["Branch ",t+1," (",n.sections.length," sections)"]}),e("span",{className:"branch-end",children:["Ends at: ",n.sections[n.sections.length-1]]}),a&&e("button",{className:"expand-all-button",onClick:s=>_(n,s),style:{marginLeft:"auto",padding:"6px 14px",fontSize:"12px",cursor:"pointer",backgroundColor:"rgba(255, 255, 255, 0.2)",color:"white",border:"1px solid rgba(255, 255, 255, 0.3)",borderRadius:"4px",fontWeight:"500",transition:"background-color 0.2s"},onMouseEnter:s=>s.target.style.backgroundColor="rgba(255, 255, 255, 0.3)",onMouseLeave:s=>s.target.style.backgroundColor="rgba(255, 255, 255, 0.2)",children:n.sections.every(s=>g.has(`${n.pathId}-${s}`))?"Collapse All":"Expand All"})]}),a&&e("div",{className:"branch-content",children:n.sections.map((s,i)=>{const o=d[s];if(!o)return null;const c=`${n.pathId}-${s}`,p=g.has(c),r=i>0?n.choices[i-1]:null;return e("div",{className:"section-item",children:[e("div",{className:"section-header",onClick:()=>H(c),children:[e("span",{className:"section-toggle",children:p?"▼":"▶"}),e("span",{className:"section-id",children:s}),e("span",{className:"section-title",children:o.title})]}),p&&e("div",{className:"section-content",children:[e("div",{className:"section-meta",children:[e("div",{className:"meta-item",children:[e("strong",{children:"File:"})," ",e("code",{children:["sections/",s,".md"]})]}),r&&e("div",{className:"meta-item choice-path",children:[e("strong",{children:"Choice that led here:"}),' "',r,'"']})]}),e("div",{className:"section-body",dangerouslySetInnerHTML:{__html:o.bodyHtml}}),o.choices&&o.choices.length>0&&e("div",{className:"section-choices-info",children:[e("strong",{children:"Choices from this section:"}),e("ul",{children:o.choices.map((N,w)=>e("li",{children:['"',N.text,'" → ',N.target||"N/A"]},w))})]})]})]},c)})})]},n.pathId)})})]}):e("div",{className:"error",children:[e("h1",{children:"Error"}),e("p",{children:"No game data available."})]})}export{z as Branches};
